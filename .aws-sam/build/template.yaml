AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31
Description: 'serverless-todos

  Sample SAM Template for serverless_todos

  '
Globals:
  Function:
    Timeout: 3
Resources:
  Table:
    Type: AWS::Serverless::SimpleTable
    Properties:
      TableName: Todos
      PrimaryKey:
        Name: id
        Type: String
  PutFunction:
    Type: AWS::Serverless::Function
    Metadata:
      BuildMethod: rust-cargolambda
      BuildProperties:
        Binary: PutToDo
      SamResourceId: PutFunction
    Properties:
      CodeUri: PutFunction
      Handler: bootstrap
      Runtime: provided.al2
      Architectures:
      - x86_64
      Events:
        PutTodo:
          Type: Api
          Properties:
            Path: /todo
            Method: post
      Environment:
        Variables:
          TABLE_NAME:
            Ref: Table
      Policies:
      - DynamoDBCrudPolicy:
          TableName:
            Ref: Table
  GetFunction:
    Type: AWS::Serverless::Function
    Metadata:
      BuildMethod: rust-cargolambda
      BuildProperties:
        Binary: GetToDo
      SamResourceId: GetFunction
    Properties:
      CodeUri: GetFunction
      Handler: bootstrap
      Runtime: provided.al2
      Architectures:
      - x86_64
      Events:
        GetTodo:
          Type: Api
          Properties:
            Path: /todo/{id}
            Method: get
      Environment:
        Variables:
          TABLE_NAME:
            Ref: Table
      Policies:
      - DynamoDBCrudPolicy:
          TableName:
            Ref: Table
  UpdateFunction:
    Type: AWS::Serverless::Function
    Metadata:
      BuildMethod: rust-cargolambda
      BuildProperties:
        Binary: UpdateToDo
      SamResourceId: UpdateFunction
    Properties:
      CodeUri: UpdateFunction
      Handler: bootstrap
      Runtime: provided.al2
      Architectures:
      - x86_64
      Events:
        UpdateTodo:
          Type: Api
          Properties:
            Path: /todo
            Method: put
      Environment:
        Variables:
          TABLE_NAME:
            Ref: Table
      Policies:
      - DynamoDBCrudPolicy:
          TableName:
            Ref: Table
  DeleteFunction:
    Type: AWS::Serverless::Function
    Metadata:
      BuildMethod: rust-cargolambda
      BuildProperties:
        Binary: DeleteToDo
      SamResourceId: DeleteFunction
    Properties:
      CodeUri: DeleteFunction
      Handler: bootstrap
      Runtime: provided.al2
      Architectures:
      - x86_64
      Events:
        DeleteTodo:
          Type: Api
          Properties:
            Path: /todo/{id}
            Method: delete
      Environment:
        Variables:
          TABLE_NAME:
            Ref: Table
      Policies:
      - DynamoDBCrudPolicy:
          TableName:
            Ref: Table
Outputs:
  PutApi:
    Description: API Gateway endpoint URL for Prod stage for Put function
    Value:
      Fn::Sub: https://${ServerlessRestApi}.execute-api.${AWS::Region}.${AWS::URLSuffix}/Prod/
  PutFunction:
    Description: Post Lambda Function ARN
    Value:
      Fn::GetAtt:
      - PutFunction
      - Arn
  GetApi:
    Description: API Gateway endpoint URL for Prod stage for Get function
    Value:
      Fn::Sub: https://${ServerlessRestApi}.execute-api.${AWS::Region}.${AWS::URLSuffix}/Prod/
  GetFunction:
    Description: Post Lambda Function ARN
    Value:
      Fn::GetAtt:
      - GetFunction
      - Arn
  UpdateApi:
    Description: API Gateway endpoint URL for Prod stage for Update function
    Value:
      Fn::Sub: https://${ServerlessRestApi}.execute-api.${AWS::Region}.${AWS::URLSuffix}/Prod/
  UpdateFunction:
    Description: Post Lambda Function ARN
    Value:
      Fn::GetAtt:
      - UpdateFunction
      - Arn
  DeleteApi:
    Description: API Gateway endpoint URL for Prod stage for Delete function
    Value:
      Fn::Sub: https://${ServerlessRestApi}.execute-api.${AWS::Region}.${AWS::URLSuffix}/Prod/
  DeleteFunction:
    Description: Post Lambda Function ARN
    Value:
      Fn::GetAtt:
      - DeleteFunction
      - Arn
  Table:
    Description: DynamoDB table name
    Value:
      Fn::GetAtt:
      - Table
      - Arn
